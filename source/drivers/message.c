/***************************************************************************//**
  @file     encoder.c
  @brief    Encoder Driver
  @author   Micho
 ******************************************************************************/

/*******************************************************************************
 *                              INCLUDE HEADER FILES                            *
 ******************************************************************************/

#include "board.h"
#include "message.h"


/*******************************************************************************
 *                 CONSTANT AND MACRO DEFINITIONS USING #DEFINE                 *
 ******************************************************************************/


/*******************************************************************************
 *                              ENUMS AND STRUCTURES                            *
 ******************************************************************************/


/*******************************************************************************
 *      FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE         *
 ******************************************************************************/



/*******************************************************************************
 *                                  VARIABLES                                   *
 ******************************************************************************/
static bool status = NO_MSG;
messageEvent_t msg_event;

//Sem√°foro del mensaje
static OS_SEM semMsg;
/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

void messageInit(void)
{
	//Creamos el semaforo
	OS_ERR os_err;
	OSSemCreate(&semMsg, "Sem Message", 0u, &os_err);
}


bool messageHandlerStatus(){
    if(status){
		status = false;
		return true;
	}
    else{
		return false;
	}
}

messageEvent_t messageGetEvent(){          
    if(!status){
        msg_event = MSG_PENDING;
    } else {
        msg_event = NO_MSG;
    }
	return msg_event;
}

bool messageSetStatus(bool change_state){            //Setter para que la app me lo pueda cambiar
	status = change_state;
	OS_ERR os_err;
	OSSemPost(&semMsg, OS_OPT_POST_1, &os_err);
	return status;
}


OS_SEM* getMessageSemPointer()
{
	return &semMsg;
}
/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/



/*******************************************************************************
 ******************************************************************************/
